#################################################
# rsnapshot.conf - rsnapshot configuration file #
#################################################
#                                               #
# PLEASE BE AWARE OF THE FOLLOWING RULES:       #
#                                               #
# This file requires tabs between elements      #
#                                               #
# Directories require a trailing slash:         #
#   right: /home/                               #
#   wrong: /home                                #
#                                               #
#################################################

#######################
# CONFIG FILE VERSION #
#######################

config_version	1.2

###########################
# SNAPSHOT ROOT DIRECTORY #
###########################

# All snapshots will be stored under this root directory.
#
snapshot_root	/opt/dumper/data/

#################################
# EXTERNAL PROGRAM DEPENDENCIES #
#################################

# LINUX USERS:   Be sure to uncomment "cmd_cp". This gives you extra features.
# EVERYONE ELSE: Leave "cmd_cp" commented out for compatibility.
#
# See the README file or the man page for more details.
#
cmd_cp		/bin/cp

# uncomment this to use the rm program instead of the built-in perl routine.
#
cmd_rm		/bin/rm

# rsync must be enabled for anything to work. This is the only command that
# must be enabled.
#
cmd_rsync	/usr/bin/rsync

# Uncomment this to enable remote ssh backups over rsync.
#
cmd_ssh	/usr/bin/ssh

# Comment this out to disable syslog support.
#
cmd_logger	/usr/bin/logger

# Uncomment this to specify the path to "du" for disk usage checks.
# If you have an older version of "du", you may also want to check the
# "du_args" parameter below.
#
cmd_du		/usr/bin/du

# Uncomment this to specify the path to rsnapshot-diff.
#
cmd_rsnapshot_diff	/usr/bin/rsnapshot-diff

# Specify the path to a script (and any optional arguments) to run right
# before rsnapshot syncs files
#
cmd_preexec	/usr/bin/kinit -t /opt/dumper/config/dumper.keytab dumper

# Specify the path to a script (and any optional arguments) to run right
# after rsnapshot syncs files
#
cmd_postexec	/usr/bin/kdestroy -credential=dumper

#########################################
#           BACKUP INTERVALS            #
# Must be unique and in ascending order #
# i.e. hourly, daily, weekly, etc.      #
#########################################

interval	daily	7
interval	weekly	4
interval	monthly	3

############################################
#              GLOBAL OPTIONS              #
# All are optional, with sensible defaults #
############################################

# Verbose level, 1 through 5.
# 1     Quiet           Print fatal errors only
# 2     Default         Print errors and warnings only
# 3     Verbose         Show equivalent shell commands being executed
# 4     Extra Verbose   Show extra verbose information
# 5     Debug mode      Everything
#
verbose		2

# Same as "verbose" above, but controls the amount of data sent to the
# logfile, if one is being used. The default is 3.
#
loglevel	2

# If you enable this, data will be written to the file you specify. The
# amount of data written is controlled by the "loglevel" parameter.
#
logfile	/opt/dumper/rsnapshot.log

# If enabled, rsnapshot will write a lockfile to prevent two instances
# from running simultaneously (and messing up the snapshot_root).
# If you enable this, make sure the lockfile directory is not world
# writable. Otherwise anyone can prevent the program from running.
#
lockfile	/var/run/rsnapshot.pid

# Default rsync args. All rsync commands have at least these options set.
#
rsync_short_args	-a
rsync_long_args	--delete --numeric-ids --relative --delete-excluded --rsync-path='ionice -c2 -n7 nice -n15 sudo rsync' --progress

# ssh has no args passed by default, but you can specify some here.
#
ssh_args	-o UserKnownHostsFile=/opt/dumper/config/known_hosts -i /opt/dumper/config/id_rsa -c arcfour,arcfour128,arcfour256,blowfish-cbc

# Default arguments for the "du" program (for disk space reporting).
# The GNU version of "du" is preferred. See the man page for more details.
# If your version of "du" doesn't support the -h flag, try -k flag instead.
#
#du_args	-csh

# If this is enabled, rsync won't span filesystem partitions within a
# backup point. This essentially passes the -x option to rsync.
# The default is 0 (off).
#
#one_fs		0

# When sync_first is enabled, it changes the default behaviour of rsnapshot.
# Normally, when rsnapshot is called with its lowest interval
# (i.e.: "rsnapshot hourly"), it will sync files AND rotate the lowest
# intervals. With sync_first enabled, "rsnapshot sync" handles the file sync,
# and all interval calls simply rotate files. See the man page for more
# details. The default is 0 (off).
#
sync_first	1

# If enabled, rsnapshot will move the oldest directory for each interval
# to [interval_name].delete, then it will remove the lockfile and delete
# that directory just before it exits. The default is 0 (off).
#
#use_lazy_deletes	0

# Number of rsync re-tries. If you experience any network problems or
# network card issues that tend to cause ssh to crap-out with
# "Corrupted MAC on input" errors, for example, set this to a non-zero
# value to have the rsync operation re-tried
#
#rsync_numtries 0

###############################
### BACKUP POINTS / SCRIPTS ###
###############################

# blackhole
backup	dumper@blackhole:/etc/					blackhole/
backup	dumper@blackhole:/root/					blackhole/
backup	dumper@blackhole:/var/mail/				blackhole/

# death
backup	dumper@death.ocf.berkeley.edu:/etc/			death/		rsync_long_args=--delete --numeric-ids --relative --delete-excluded --rsync-path='nice -n15 sudo rsync'
backup	dumper@death.ocf.berkeley.edu:/root/			death/		rsync_long_args=--delete --numeric-ids --relative --delete-excluded --rsync-path='nice -n15 sudo rsync'
backup	dumper@death.ocf.berkeley.edu:/usr/local/etc/		death/		rsync_long_args=--delete --numeric-ids --relative --delete-excluded --rsync-path='nice -n15 sudo rsync'

# hal
backup	dumper@hal:/etc/					hal/
backup	dumper@hal:/root/					hal/
backup	dumper@hal:/opt/megacli/				hal/

# lightning
backup	dumper@lightning:/etc/					lightning/
backup	dumper@lightning:/root/					lightning/
backup	dumper@lightning:/opt/puppet/				lightning/

# pestilence
backup	dumper@pestilence:/etc/					pestilence/
backup	dumper@pestilence:/root/				pestilence/

# sandstorm
backup	dumper@sandstorm:/etc/					sandstorm/
backup	dumper@sandstorm:/root/					sandstorm/
backup	dumper@sandstorm:/opt/deforestation/			sandstorm/

# supernova
backup	dumper@supernova:/etc/					supernova/	+rsync_long_args=--exclude=/etc/pykota
backup	dumper@supernova:/root/					supernova/
backup	dumper@supernova:/home/d/da/daradib/			supernova/
backup	dumper@supernova:/opt/adm/				supernova/
backup	dumper@supernova:/opt/mlocal/				supernova/
backup	dumper@supernova:/opt/ocf/				supernova/
backup	dumper@supernova:/opt/src/online-approve/		supernova/
backup	dumper@supernova:/opt/src/users/daradib/		supernova/
backup	dumper@supernova:/services/http/users/d/daradib/	supernova/

# tsunami
backup	dumper@tsunami:/etc/					tsunami/	+rsync_long_args=--exclude=/etc/pykota
backup	dumper@tsunami:/root/					tsunami/

# biohazard
# drought
# emp
# epidemic
# jaws
# maelstrom
# monsoon
# mudslide
# pileup
# tempest
