<VirtualHost *:443>
    ServerName <%= @fqdn %>
    ServerAlias ssh.ocf.berkeley.edu ssh.ocf ssh <%= @hostname %>.ocf <%= @hostname %>
    ServerAdmin help@ocf.berkeley.edu

    # canonical hostname is ssh.ocf.berkeley.edu
    RewriteEngine on
    RewriteCond %{HTTP_HOST} !^ssh\.ocf\.berkeley\.edu$ [NC]
    RewriteRule ^/(.*)$ https://ssh.ocf.berkeley.edu/$1 [R=301]

    ProxyPass / http://localhost:4200/
    ProxyPassReverse / http://localhost:4200/

    CustomLog ${APACHE_LOG_DIR}/ssl_access.log combined

    SSLEngine on
    SSLCertificateFile /etc/ssl/private/<%= @fqdn %>.crt
    SSLCertificateKeyFile /etc/ssl/private/<%= @fqdn %>.key
    SSLCertificateChainFile /etc/ssl/private/<%= @fqdn %>.bundle

    <FilesMatch "\.(cgi|shtml|phtml|php)$">
        SSLOptions +StdEnvVars
    </FilesMatch>
    <Directory /usr/lib/cgi-bin>
        SSLOptions +StdEnvVars
    </Directory>
</VirtualHost>
