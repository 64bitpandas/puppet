# Legacy redirects for accounts.ocf.berkeley.edu -> ocfweb
<VirtualHost *:443>
    ServerName accounts.ocf.berkeley.edu
    ServerAdmin help@ocf.berkeley.edu

    SSLEngine on
	SSLCertificateFile /etc/ssl/private/<%= @fqdn %>.crt
	SSLCertificateKeyFile /etc/ssl/private/<%= @fqdn %>.key
	SSLCertificateChainFile /etc/ssl/certs/incommon-intermediate.crt
    Include ssl-common.conf

    RewriteEngine on
    RewriteRule ^/(change-password(/.*)?)?$ https://www.ocf.berkeley.edu/account/password [R=301]
    RewriteRule ^/commands(/.*)?$ https://www.ocf.berkeley.edu/account/commands [R=301]
    RewriteRule ^/request-account(/.*)?$ https://www.ocf.berkeley.edu/account/register [R=301]
    RewriteRule ^/request-vhost(/.*)?$ https://www.ocf.berkeley.edu/account/vhost/ [R=301]

    Header set Strict-Transport-Security "max-age=31536000"
</VirtualHost>

# redirect http aliases to https version so we can enable HSTS (for next time)
<VirtualHost *:80>
    ServerName accounts.ocf.berkeley.edu
    ServerAdmin help@ocf.berkeley.edu

    Redirect 301 / https://accounts.ocf.berkeley.edu/
</VirtualHost>
