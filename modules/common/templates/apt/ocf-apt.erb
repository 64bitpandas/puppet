#!/bin/sh

# Prevent "TERM is not set, so the dialog frontend is not usable." error message
PATH='/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'

apt_cleanup(){
    # update cache then remove downloaded package archives, unused packages, and old config files
    /usr/bin/aptitude update --quiet > /dev/null
    /usr/bin/aptitude clean --quiet > /dev/null
    /usr/bin/aptitude purge --assume-yes --quiet '?garbage' > /dev/null
    /usr/bin/aptitude purge --assume-yes --quiet '?config-files' > /dev/null
}

if [ ! -f /var/lock/aptitude ]; then
  apt_cleanup
elif fuser -s /var/lib/dpkg/lock 2> /dev/null; then
  true
else
  apt_cleanup
fi

<% if desktop -%>
# update-flashplugin-nonfree updates Adobe Flash Player
[ -x /usr/sbin/update-flashplugin-nonfree ] && /usr/sbin/update-flashplugin-nonfree --install --quiet || exit 0
<% end -%>
